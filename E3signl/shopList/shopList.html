<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../css/icons-extra.css"/>
		<style type="text/css">
			img{
				height: 80px;width: 100px;
			}
			#shopUl{
				background: white!important;
				margin: 10px;
			}
			#shopUl li{
				list-style: none;				
			}
			.shopSpan{				
				float: left;
				/*margin-bottom: 5px;*/
				margin-left: 10px;
			}
			.shopSmall{
				font-size: 12px;
				color: grey;
			}
			.mui-icon{
				color: red;
				font-size:15px;
				margin-left: -5px;
			}
		</style>
	<template id='shopTemp' style="background: white;">
		<li  class="mui-table-view-cell" data-id = "00">
			<div style="">
			<div class="" style="float: left;">
				<img src="../img/detail/3.jpg"/>
			</div>
			<div class="shopSpan">
				<div class="">
					<h5>火锅店(闵行店)</h5>
					<span class="mui-icon mui-icon-star-filled"/>
					<span class="mui-icon mui-icon-star-filled"/>
					<span class="mui-icon mui-icon-star-filled"/>
					<span class="mui-icon mui-icon-star-filled"/>
					<span class="mui-icon mui-icon-starhalf"/>
					<span  class="shopSmall">
						20￥/人
					</span>
				</div>
				<div class="" style="">
					<span class="shopSmall">
						韩国菜 <span>|							
						</span> 北新泾
					</span><span class="shopSmall" style="background: lightgray;margin-left: 80px;">
						1000m
					</span><br />
					<span class="shopSmall mui-icon-extra mui-icon-extra-heart-filled">
						1000人消费
					</span>	
					<div style="border-top: 1px solid lightgrey;">	
						<span class="shopSmall mui-icon-extra mui-icon-extra-new">
							商家优惠，满30立减8元
						</span>
					</div>
				</div>	
			</div>		
			</div>	
		</li>
	</template>	
	</head>

	<body>
		<!--下拉刷新容器-->
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<!--数据列表-->
				<ul id="shopUl" class="mui-table-view">
					
				</ul>
			</div>
		</div> 
		<script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript">
			var detailHead = null;
			var shopIndex = null;
			mui.plusReady(function(){
				detailHead = mui.preload({
				id:'detailHead.html',
				url:'detailHead.html',
				styles:{
					top:'0px',
					bottom:'0px'
				}
			});
//			点击商铺列表进详情
				mui("ul").on('tap','li',function(){
					shopIndex=$(this).data('id');
//					mui.toast(shopIndex);
					mui.fire(detailHead,'initDetail',{shopIndex:shopIndex});
					detailHead.show();					
				});	
			});
			mui.init({preloadPages:[{
					url:'detailHead.html',
					id:'detailHead.html',
//					styles:{
//							top:0,
//							bottom:0
//						}
					}],
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: pulldownRefresh
					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					}
				}
			});			

			//首次进入时加载第一个页面
			document.addEventListener('scrollRefush',function(){
				mui('#pullrefresh').pullRefresh().pulldownLoading();
//				mui('#pullrefresh').pullRefresh().scrollTo(0,100,0);
			})
			/**
			 * 下拉刷新具体业务实现
			 */
//			var shopTemp = $("#shopTemp").clone(true);
			var dialog=document.querySelector('#shopTemp');
			var flag=1;
			function pulldownRefresh() {
				setTimeout(function() {					
					var shopUl= document.body.querySelector('#shopUl');
					var cloneLi = dialog.content.cloneNode(true);
					shopUl.appendChild(cloneLi);
					$('#shopUl li').last().data('id',flag);
					flag++;
//					$("#shopTemp li").data('id','2').clone(true).show().appendTo($("#shopUl"));
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
				}, 500);
			}
			var count = 0;
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				setTimeout(function() {
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(); //refresh completed
				}, 500);
			}
			if (mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
//						mui('#pullrefresh').pullRefresh().pullupLoading();
					}, 1000);

				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				});
			}
		</script>
	</body>

</html>