<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="css/mui.min.css" rel="stylesheet"/> 
    <style type="text/css">
    	body{
    		background-image:url(img/bg.jpg);
    	}
		#mainContent{
			margin: 0 auto;
			padding: 10px;
			margin-top: 50px;
			width: 90%;
			height: 350px;
			/*border: 1px solid white;*/
			border-radius: 20px 20px 20px 20px;
		}
		#foot{
			padding-left: 25%; 
		}
		#foot span{			
			text-align: center;
		}
		#foot span i{ 
			margin-left: 15px;
			font-size: 50px!important;
		}
   </style>
</head>
<body>
	
	<h4 style="color: white;text-align: center;margin-top: 20px!important;">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		注册</h4>
	<div id="mainContent">
		<div style="width: 60px;height:60px;border-radius: 50% 50% 50% 50%;margin: 0 auto;background-color: lightgoldenrodyellow;">
			<img src="img/666.png"style="margin: 5px;width: 50px;"/>
		</div>
		<div>
			<input style="color: white;background-color: transparent;border: none;border-bottom: 1px solid white;"placeholder="手机号" type="text" name="phone"/>
			<input style="width: 50%;color: white;background-color: transparent;border: none;border-bottom: 1px solid white;"placeholder="验证码" type="text" name="check"/>
			<button id="getCode" style="width: 40%;" >获取验证码</button>
			<input style="color: white;background-color: transparent;border: none;border-bottom: 1px solid white;"placeholder="密码" type="password" name="password"/>
			<!--<div style="text-align: center;">-->
				<button id="reg" style="margin-top: 40px;border-radius: 20px 20px 20px 20px;height: 50px;width: 100%;" type="button" class="mui-btn mui-btn-green">注册</button>
			<!--</div>-->
			<div style="margin-top: 50px;width: 100%;text-align: center;color: lightgray;">已注册过，<span id="login" style="color: #4cd964;">登录</span></div>
		</div>
	</div>
	<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/mui.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/av.js" type="text/javascript" charset="utf-8"></script>
</body>
<script type="text/javascript" charset="utf-8">
    mui.init();
	mui.plusReady(function(){
		$('#login').on('tap',function(){
			mui.openWindow({
			url:'login.html',id:'login.html',
			show:{
				aniShow:'slide-in-right',duration:400
			}});
		});
	});
	
	$("#getCode").on('tap',function(){
		var mobilePhoneNumber = $('input[name=phone]').val();
		if(mobilePhoneNumber==''){
			mui.toast('请填写用户名!');
			return false;
		}
		var query = new AV.Query('_User');
		query.equalTo('mobilePhoneNumber',mobilePhoneNumber);
		query.find({
			success:function(resp){
				if(resp.length){
					mui.toast('该手机已经注册，请直接登录');
					return;
				}else{
					mui.ajax({ 			
		 			url:"https://api.leancloud.cn/1.1/requestSmsCode",
		 			type:'post',
		 			headers:{
		 				"X-LC-Id": "91TtjFpYIeeLfxTlfYAo9GLT-gzGzoHsz",
		 				"X-LC-Key": "lLxPT0gKqEBd2Vk56OCjYfbp",
		 				"Content-Type": "application/json"
		 			},
		 			data:{
		   				"mobilePhoneNumber":mobilePhoneNumber
		 			},
		 			sucess:function(resp){
		 			},
		 			error:function(error){
		 				mui.toast(JSON.stringify(error));
		 			}
		 		});
				}
			},
			error:function(error){
				alert(JSON.stringify(error));
			}
			});		
	});

	$('#reg').on('tap',function(){
		var mobilePhoneNumber = $('input[name=phone]').val();
		var smsCode = $('input[name=check]').val();
//		var 
		
		var password = $('input[name=password]').val();
		console.log(password);
		if(mobilePhoneNumber==''||password == ''){
			mui.toast('请填写用户名和密码!');
			return false;
		}
 		mui.ajax({ 			
 			url:"https://api.leancloud.cn/1.1/usersByMobilePhone",
 			type:'post',
 			headers:{
 				"X-LC-Id": "91TtjFpYIeeLfxTlfYAo9GLT-gzGzoHsz",
 				"X-LC-Key": "lLxPT0gKqEBd2Vk56OCjYfbp",
 				"Content-Type": "application/json"
 			},
 			data:{
   				"mobilePhoneNumber":mobilePhoneNumber,
   				"smsCode":smsCode,				
				'password':password
 			},
 			success:function(resp){
 				alert('注册成功');
 				mui.openWindow({
				url:'pullrefresh_main.html',id:'pullrefresh_main.html',
				show:{
					aniShow:'slide-in-right',duration:400
				}});
 			},
 			error:function(error){
 				mui.toast('手机或验证码填写失败');
 				debugger
 			}
 		});
// 		user.signUp().then(function(loginedUser){
// 			mui.openWindow({
//			url:'pullrefresh_main.html',id:'pullrefresh_main.html',
//			show:{
//				aniShow:'slide-in-right',duration:400
//			}});
//			alert(JSON.stringify(loginedUser));
// 		},(function(error){
// 			alert(JSON.stringify(error));
// 		}));
	});
      	
</script>
</html>